<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <link rel="stylesheet" type="text/css" href="assets/element-plus/index.css">
    <script src="/assets/vue/vue.global.js"></script>
    <script src="/assets/element-plus/index.full.js"></script>
    <script src="/assets/axios/axios.js"></script>
    <style>
        .register-box {
            border: 1px solid #DCDFE6;
            /*border: 1px solid;*/
            /*background-color: #DCDFE6;*/
            width: 350px;
            margin: 180px auto;
            padding: 35px 35px 15px 35px;
            border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            box-shadow: 0 0 25px #909399;
            top: 100px;
        }
        .register-title {
            text-align: center;
            margin: 0 auto 40px auto;
            color: #303133;
        }
    </style>
</head>
<body>
    <div id="app">
        <el-form ref="registerForm" :model="form" :rules="rules" label-width="80px" class="register-box">
            <h2 class="register-title">注册</h2>
            <el-form-item label="账号" prop="userNo">
                <el-input type="text" placeholder="请输入账号" v-model="form.userNo"></el-input>
            </el-form-item>
            <el-form-item label="密码" prop="password">
                <el-input v-model="form.password" type="password" placeholder="请输入密码"></el-input>
            </el-form-item>
            <el-form-item label="确认密码" prop="confirmPassword">
                <el-input v-model="form.confirmPassword" type="password" placeholder="请再次输入密码"></el-input>
            </el-form-item>
            <el-form-item label="昵称" prop="userName">
                <el-input v-model="form.userName" type="text" placeholder="请输入昵称"></el-input>
            </el-form-item>
            <el-form-item label="地址" prop="address">
                <el-input v-model="form.address" type="text" placeholder="请输入地址"></el-input>
            </el-form-item>
            <el-form-item label="手机号" prop="phone">
                <el-input v-model="form.phone" type="text" placeholder="请输入手机号"></el-input>
            </el-form-item>
            <el-form-item label="选择身份" prop="roleType">
                <el-select v-model="form.roleType" placeholder="请选择身份">
                    <el-option label="管理员" value="0"></el-option>
                    <el-option label="店铺" value="1"></el-option>
                    <el-option label="设计师" value="2"></el-option>
                    <el-option label="用户" value="3"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="营业执照" prop="businessLicense" v-if="form.roleType == 1">
                <el-input v-model="form.businessLicense" type="text" placeholder="请输入营业执照号"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" v-on:click="onSubmit('registerForm')" style="width:200px">注册</el-button>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" v-on:click="login" style="width:200px">已有账号(去登录)</el-button>
            </el-form-item>
        </el-form>
    </div>

    <script>
        const Main = {
            data() {
                return {
                    dialogFormVisible: false,
                    form: {
                        userName: "",
                        userNo:"",
                        signature:"",
                        password: "",
                        confirmPassword: "",
                        address: "",
                        phone: "",
                        roleType: ""
                    }
                    , rules: {
                        userNo: [
                            {required: true, message: '账号不能为空', trigger: 'blur'}
                        ],
                        password: [
                            {required: true, message: '密码不能为空', trigger: 'blur'}
                        ],
                        confirmPassword: [
                            {required: true, message: '确认密码不能为空', trigger: 'blur'}
                        ],
                        address: [
                            {required: true, message: '地址不能为空', trigger: 'blur'}
                        ],
                        phone: [
                            {required: true, message: '手机号不能为空', trigger: 'blur'}
                        ],
                        roleType: [
                            {required: true, message: '身份不能为空', trigger: 'blur'}
                        ],
                        businessLicense: [
                            {required: true, message: '营业执照不能为空', trigger: 'blur'}
                        ]
                    }
                }
            },

            methods: {

                login() {
                    window.location.href="/login.html"
                },

                onSubmit(formName) {
                    const form = this.$refs[formName];
                    form.validate((valid) => {
                        if (valid) {
                            let form = this.form;
                            const $message = this.$message;
                            if (!(/^1[3456789]\d{9}$/.test(form.phone))) {
                                $message.error({message: '手机号格式不正确', offset: 100})
                                return ;
                            }
                            axios.post("/api/user/register", JSON.stringify(form), {
                                headers: {
                                    'Content-Type':'application/json'
                                }
                            }).then(function (response) {
                                    console.log(response);
                                    const json = response.data;
                                    if (json.status === 10000) {
                                        // $message.success({message: '注册成功', offset: 100}
                                        $message.success({message: '注册成功', offset: 100})
                                        // window.location.href="/login.html"
                                        for (var key in form) {
                                            form[key] = ''
                                        }
                                    } else {
                                        $message.error({message: json.msg, offset: 100})
                                    }
                                })
                        }
                    })
                }
            }
        };
        const app = Vue.createApp(Main);
        app.use(ElementPlus);
        app.mount("#app");
    </script>
</body>
</html>